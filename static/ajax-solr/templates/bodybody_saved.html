<div class="full"> 

  {{#notloggedin}}
  <!-- TODO: make 'log in' be a link. -->
  <div>
    Please log in to see your saved items.
 </div>
  {{/notloggedin}}

  {{^notloggedin}}
 <div class="saved-items">
   {{#hassearches}}
  <h1>Saved Searches</h1>
  <form id="saved-searches-form" action="#">
   <div class="formactions">
    <input type="button" value="Mark all" onClick="changeAllButtons(this.form, true)">
    <input type="button" value="Clear all" onClick="changeAllButtons(this.form, false)">
    <input type="submit" name="action" value="Delete marked searches">
   </div>
   {{#savedsearches}}
  <div class="saveditem" id="search-{{searchctr}}">
    <input type="checkbox" name="searchid" value="{{searchuri}}">
    {{searchpre}}
    <a href="/semantic2/alpha/explorer/publications#{{searchuri}}">{{searchtext}}</a>
  </div>
 {{/savedsearches}}
 </form>
  {{/hassearches}}
  {{^hassearches}}
  <h1>No saved searches</h1>
  {{/hassearches}}
 </div>

  <div class="saved-items">
    {{#haspubs}}
  <h1>Saved Publications</h1>
  <form id="saved-pubs-form" action="#">
  <div class="formactions">  
<input type="button" value="Mark all" onClick="changeAllButtons(this.form, true)">
<input type="button" value="Clear all" onClick="changeAllButtons(this.form, false)">
<input type="submit" name="action" value="Delete marked">
<!-- TODO: the current approach forces the bibtex/myADS results to
     be displayed by fancybox; Doug thinks that this is not ideal
     since he'd like to be able to have it open in a new tab/window.
     -->
<input type="button" value="Get as BibTex" onClick="getAsBibTex(this.form)">
<button type="button" name="myads" value="Send to myADS"
    onClick="saveToMyADS(this.form)">
    <img src="/images/ADSlabs-button.png" alt="[myADS logo]">
</button>
  </div>  
    {{#savedpubs}}
    <div class="saveditem" id="pub-{{pubctr}}">
      <input type="checkbox" name="pubid" value="{{{pubid}}}">
      {{linkpre}}
      <a href="/semantic2/alpha/explorer/publications#fq={{linkuri}}&q=*%3A*">{{{linktext}}}</a>
    </div>
    {{/savedpubs}}
    </form>
    {{/haspubs}}
    {{^haspubs}}
    <h1>No saved publications</h1>
    {{/haspubs}}
    </div>
{{/notloggedin}}
    
	<!-- I assume this is a sensible time to add the handlers -->
	<script type='text/javascript'>
function changeAllButtons(form, newstate) {
  $(form).find('input[type=checkbox]').each(function() { this.checked = newstate; });
}

// var fancyboxOpts = { 'autoDimensions': false, 'width': 1024, 'height': 768 };

function getAsBibTex(form) {
  var data = [];
  $(form).find('input[type=checkbox]').each(function() {
    if (this.checked) { data.push(this.value) };
  });
 if (data.length == 0) { return false; }
 $.fancybox.showActivity();
 $.post(SITEPREFIX+'/getasbibtex', JSON.stringify({'docids':data}),
  function(resp) { $.fancybox('<pre>'+resp+'</pre>'); });
 return false;
}

function saveToMyADS(form) {
  var data = [];
  $(form).find('input[type=checkbox]').each(function() {
    if (this.checked) { data.push(this.value) };
  });
 if (data.length == 0) { return false; }
  $.fancybox.showActivity();
 $.post(SITEPREFIX+'/savepubstomyads', JSON.stringify({'docids':data}),
  function(resp) { $.fancybox('<pre>'+resp+'</pre>'); });
 return false;
}
    
// relying on SITEPREFIX being in scope

function submitAction(path, idname) {
    return function() {
      var data = [];
      $(this).find('input[type=checkbox]').each(function() {
        if (this.checked) { data.push(this.value); }
      });
      if (data.length == 0) { return false; }
      var map = { "action": "delete" };
      map[idname] = data;
      $.post(SITEPREFIX+path, JSON.stringify(map), function(resp) {
        // reload on success or error
        window.location.reload();
      });
    };
}

$('#saved-searches-form').submit(submitAction('/deletesearches', 'searchid'));
$('#saved-pubs-form').submit(submitAction('/deletepubs', 'pubid'));

	</script>
</div>
